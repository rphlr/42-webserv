<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>WEBSERV TEST SITE</title>
	<link rel="stylesheet" href="testStyle.css">
</head>
<body>

	<header>
		<h1>Website magnifique</h1>
	</header>

	<nav>
		<a href="/default_webpages/siteHome.html">Home</a></li>
		<a href="/default_webpages/siteForm.html">Form</a></li>
		<a href="/default_webpages/siteUpDownload.html">Upload / Download</a></li>
	</nav>

	<main>
		<section id="signup">
			<h2>Sign Up for Free</h2>
			
			<form action="cgi" method="post">
				<div class="form-group">
					<label for="firstName">First Name*</label>
					<input type="text" id="firstName" name="firstName" required>
				</div>

				<div class="form-group">
					<label for="lastName">Last Name*</label>
					<input type="text" id="lastName" name="lastName" required>
				</div>

				<div class="form-group">
					<label for="email">Email Address*</label>
					<input type="email" id="email" name="email" required>
				</div>

				<div class="form-group">
					<label for= 
						.0"password">Set A Password*</label>
					<input type="password" id="password" name="password" required>
				</div>

				<button type="submit" >GET STARTED</button>
			</form>
		</section>

		<section id="upload">
			<h2>Upload File here</h2>
			<form method="post" enctype="multipart/form-data">
				<input type="file" name="file">
				<button type="submit" name="submit">Upload</button>
			</form>
		</section>

		<section id="download">
			<h2>Download Files here</h2>
			<div id="file-links">Loading files...</div>

			<!-- <script>
				fetch('../cgi-bin/files.json')
				.then(response => response.json())
				.then(data => {
					const container = document.getElementById('file-links');
					if (data.files && data.files.length > 0) {
					const list = document.createElement('ul');
					data.files.forEach(file => {
						const listItem = document.createElement('li');
						const link = document.createElement('a');
						link.href = `../default_webpages/uploads/${file}`;
						link.textContent = file;
						link.download = file;
						listItem.appendChild(link);
						list.appendChild(listItem);
						// echo the path to link
						console.log(link.href);
					});
					container.innerHTML = '';
					container.appendChild(list);

					} else {
					container.textContent = 'No files to download.';
					}
				})
				.catch(() => {
					document.getElementById('file-links').textContent = 'Failed to load files.';
				});
			</script> -->
			<script>
				fetch('../cgi-bin/files.json')
				.then(response => response.json())
				.then(data => {
					const container = document.getElementById('file-links');
					if (data.files && data.files.length > 0) {
						const list = document.createElement('ul');
						data.files.forEach(file => {
							const listItem = document.createElement('li');
				
							// Créer le bouton de suppression
							const deleteButton = document.createElement('button');
							deleteButton.textContent = 'Supprimer';
							deleteButton.onclick = function() { deleteFile(file); };
							listItem.appendChild(deleteButton);
				
							// Créer le lien de téléchargement
							const link = document.createElement('a');
							link.href = `../default_webpages/uploads/${file}`;
							link.textContent = file;
							link.download = file;
							listItem.appendChild(link);
				
							list.appendChild(listItem);
						});
						container.innerHTML = '';
						container.appendChild(list);
					} else {
						container.textContent = 'No files to download.';
					}
				})
				.catch(() => {
					document.getElementById('file-links').textContent = 'Failed to load files.';
				});
				
				// Fonction pour supprimer le fichier
				function deleteFile(fileName) {
					fetch(`../cgi-bin/deleteFile.php?file=${fileName}`, { method: 'DELETE' })
					.then(response => response.json())
					
					window.location.reload(); 
				}

				// function deleteFile(fileName) {
				// 	fetch(`../cgi-bin/deleteFile.php?file=${fileName}`, { method: 'DELETE' })
				// 	.then(response => response.json())
				// }
				</script>				
		</section>

		<!-- <section id="download">
			<h2>Download File here</h2>
			<p>Download here [insert download]</p>
		</section> -->
	</main>

	<footer>
		<p>&copy; 2024 website magnifique</p>
	</footer>

</body>
</html>